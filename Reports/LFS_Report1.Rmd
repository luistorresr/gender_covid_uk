---
title: "Track and Trace Inequalities: Exploring the impacts of COVID-19 on women and menâ€™s working lives in the UK"
author: "Luis Torres, Annegreet Veeken and Tracey Warren, University of Nottingham"
date: "30/04/2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
	warning = FALSE)

### R version
# R version 4.0.4

### R version
# R 4.0 or above

#### packages needed
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(gridExtra)) install.packages("girdExtra", repos = "http://cran.us.r-project.org")
if(!require(corrr)) install.packages("corrr", repos = "http://cran.us.r-project.org")
if(!require(Hmisc)) install.packages("Hmisc", repos = "http://cran.us.r-project.org")
if(!require(sjlabelled)) install.packages("sjlabelled", repos = "http://cran.us.r-project.org")
if(!require(ggthemes)) install.packages("ggthemes", repos = "http://cran.us.r-project.org")
if(!require(ggtext)) install.packages("ggtext", repos = "http://cran.us.r-project.org")
if(!require(ggrepel)) install.packages("ggrepel", repos = "http://cran.us.r-project.org")
if(!require(doBy)) install.packages("doBy", repos = "http://cran.us.r-project.org")
if(!require(sjmisc)) install.packages("sjmisc", repos = "http://cran.us.r-project.org")
if(!require(plotly)) install.packages("plotly", repos = "http://cran.us.r-project.org")
if(!require(flextable)) install.packages("flextable", repos = "http://cran.us.r-project.org")
if(!require(scales)) install.packages("scales", repos = "http://cran.us.r-project.org")
if(!require(descr)) install.packages("descr", repos = "http://cran.us.r-project.org")
if(!require(janitor)) install.packages("janitor", repos = "http://cran.us.r-project.org")

library(descr) # contingency table
library(tidyverse) # several tools for data manipulation
library(haven) # read SPSS, Stata, and SAS data
library(gridExtra) # arrange multiple grid-based plots on a page
library(corrr) # for correlations correlate()
library(Hmisc) # many functions useful for data analysis
library(sjmisc) # useful to set Na's
library(sjlabelled) # get_labels function
library(ggthemes) # themes for ggplot2
library(ggtext) # fancy text
library(ggrepel) # help with the position of the labels on ggplot2 graph
library(doBy) # 'do' something to data stratified 'by' some variables
library(plotly) # interactive plots
library(flextable) # formatting tables 
library(scales) # add scale symbols and colour to axis
library(janitor) # add totals to tables

#### Output configurations
options(digits = 3) # decimal points to 3
```

## Introduction

The COVID-19 outbreak has substantial consequences for gender equality in the workplace. Generally economic recessions affect men's employment the most, but this is not a typical recession. The lockdowns and social distancing measures have a unequal impact on jobs frequently done by women, like health care, cleaning and hospitality. On top of this, the closure of schools, nurseries and the switch to home-working increased childcare responsibilities for both working mothers and fathers.

Measures adopted by businesses and governments, such as flexible working and..., may be mitigating the impacts of the pandemic in ways not comparable to previous social and economic crises. - introduce ethnicity/age/income?-

Is the pandemic is narrowing or reinforcing pre-pandemic gender inequalities in our ways of working? - is this a too broad question? after all we only know about employment - To answer this question we use the UK's largest study on employment circumstances, the Labour Force Survey. More specifically, we ask 1) Which sectors have been hit the hardest by the pandemic 2) How unemployment rates differ between men and women of different ethnic background, age and income.

## Methodology

This report draws on the analysis of the 2020/21 releases of the UK Labour Force Survey (LFS). Respondents are interviewed for 5 successive waves at 3-monthly intervals and approximately 20% of the sample is replaced every quarter. In 2020, additional non-calendar quarter data -i don't know what "non-calendar" means- have been released as a response to the need of data in the context of the coronavirus pandemic.

The LFS replace non-responses with data from previous quarters. Responses brought from previous quarter represent a quarter average of 8,470,590. We remove these responses from our analyses to better account for variations between quarters. The resulted economically active population will be considered in the following sections. We only consider the working UK population between 18-64 year old.

```{r data, echo=FALSE}

load("./Data_clean/LFS_clean.rda")

N_total <- LFS_clean %>%
        filter(AGE >= 18 & AGE <= 64 & IOUTCOME <= 2) %>%
        group_by(as_label(QUARTER)) %>%
        summarise(Sample = n(), Population = sum(PWT18)) 

N_rolled <- LFS_clean %>%
        filter(AGE >= 18 & AGE <= 64 & IOUTCOME == 6) %>%
        group_by(as_label(QUARTER)) %>%
        summarise(Non_Reponse = sum(PWT18))

N_active <- LFS_clean %>% 
        filter(AGE >= 18 & AGE <= 64 & IOUTCOME <= 2 & ILODEFR <=2) %>%
        group_by(as_label(QUARTER)) %>%
        summarise(Econ_active = sum(PWT18))

N_total <- left_join(N_total, N_rolled, by = "as_label(QUARTER)")

N_total <- left_join(N_total, N_active, by = "as_label(QUARTER)")        
        
N_total %>% flextable() %>% theme_vanilla() %>%
        set_caption(caption = "Sample size and population estimates", style = "table") %>%
        bold(bold = TRUE, part = "header") %>%
        set_header_labels(`as_label(QUARTER)` = "Quarter",
                          Population = "Total Population",
                            Non_Reponse = "Non Responses",
                            Econ_active = "Economically Active") %>%
        autofit() %>%
        align_nottext_col(align = "center", header = TRUE, footer = FALSE) %>%
        add_footer_lines("Source: UK Labour Force Survey (Person)") %>%
        color(part = "footer", color = "#666666") %>%
        print(.) # final table for reporting

```

## Findings

### Gender impact of COVID-19 on employment levels

As with previous economic recessions, the impact of COVID-19 hit men's employement the most. From August-October 2020 quarter both men's and women's employment show signs of recovery. However, since the last lockdown these signs of recovery are fading for men.

```{r unemployment, echo=FALSE}
# Unemployment per sex

unem_sex <- LFS_clean %>% 
                filter(AGE >= 18 & AGE <= 64 & IOUTCOME <= 2 & ILODEFR <=2) %>%
                group_by(QUARTER, SEX, as_label(ILODEFR)) %>%
                summarise(Active = sum(PWT18))  %>% 
            pivot_wider(names_from = `as_label(ILODEFR)`, values_from = Active) %>%
            adorn_totals("col") %>%
            mutate(Rate = `Not employed` / Total) # unemployment rates per gender 

unem_sex %>% 
        ggplot(aes(x = QUARTER, y = Rate, col = as_label(SEX))) +
        geom_line(size = 1, show.legend = FALSE) +
        # geom_point(shape = 19) + 
        # geom_vline(xintercept = 3, linetype="dotted") +
  
        #scales
        scale_colour_manual(values = c("#DF9216", "#791F83")) +
        scale_y_continuous(breaks = seq(0,0.06, 0.01), limits = c(0, 0.07), labels = label_percent()) +
        scale_x_continuous(breaks = seq(1, 12, by = 1),
                         labels = month.abb[1:12]) + # I found the previous labels weird because they overlapped,
  # but is this right? I know it's in quarters, but maybe we can a note with "quarter starting with or so"
        # annotation
        labs(x = "", 
             y = "%",
             title ="Men's employment hit the most by the COVID-19 pandemic",
             subtitle  = "Unemployment rate of UK population between, 2020-2021",
             caption = c("Source: UK Labour Force Survey (Person)")) +
        annotate(geom = "text", x = 12, y = 0.053, label = "Men", color= "#DF9216") +
        annotate(geom = "text", x = 12, y = 0.040, label = "Women", color= "#791F83") +
        annotate(geom = "rect", xmin = 3,  xmax = 6, ymin = 0,  ymax = 0.07, alpha = 0.2) +
        annotate(geom = "rect", xmin = 10, xmax = 11, ymin = 0, ymax = 0.07, alpha = 0.2) +
        # theme
        theme_economist_white(gray_bg = FALSE) +
        theme(plot.title = element_text(face = "bold",
                                        margin = margin(10, 0, 10, 0),
                                        size = 13),
              axis.title.x = element_text(margin = margin(t = 5), vjust = 0, size = 10),
              axis.title.y = element_text(margin = margin(r = 3), vjust = 2, size = 10), 
              axis.text = element_text(size = 11),
              legend.position = "none",
              legend.title = element_blank()) 

```

This trend is particularly explained by the job losses in routine and semi routine occupations, like bar staff, bus drivers and receptionists. -What does routine/semi-routing mean?- -And the lower supervisory and technical?- Is there a way to make these labels more self explanatory?

```{r occupation, echo=FALSE}

LFS_clean <- LFS_clean %>% mutate(NSECMJ10_2 = recode_factor(NSECMJ10, 
                                                           `1` = "Higher managerial & professional",
                                                           `2` = "Lower managerial & professional",
                                                           `3` = "Intermediate occupations", 
                                                           `4` = "Small employers & self-employed",
                                                           `5` = "Lower supervisory & technical",
                                                           `6` = "Routine/semi-routine occupations",
                                                           `7` = "Routine/semi-routine occupations", 
                                                           `8` = "Never worked, unemployed, and nec"))  
unem_class <- LFS_clean %>% 
        filter(AGE >= 18 & AGE <= 64 & IOUTCOME <= 2 & ILODEFR <=2) %>%
        group_by(QUARTER, NSECMJ10_2, SEX, as_label(ILODEFR)) %>%
        summarise(Active = sum(PWT18))  %>% 
        pivot_wider(names_from = `as_label(ILODEFR)`, values_from = Active) %>%
        adorn_totals("col") %>%
        mutate(Rate = `Not employed` / Total) 
        

unem_class %>% 
        # select data
        select(QUARTER, NSECMJ10_2, SEX, Rate) %>%  
        filter(!is.na(Rate & as.integer(NSECMJ10_2)) & as.integer(NSECMJ10_2) != 7)  %>% 
        
        # graphic type and variables 
        ggplot(aes(x = QUARTER, y = Rate, col = as_label(SEX))) +
        geom_line(size = 1, show.legend = FALSE) +
        # geom_point(shape = 19) +  
        geom_vline(xintercept = 3, linetype="dotted") +
        geom_vline(xintercept = 10, linetype="dotted") +
        facet_wrap(.~as_label(NSECMJ10_2), ncol = 3) +
        
        #scales
        scale_colour_manual(values = c("#DF9216", "#791F83")) +
        scale_y_continuous(breaks = seq(0,0.2, 0.02), limits = c(0,0.08), labels = label_percent()) + 
        scale_x_continuous(breaks = c(1, 6, 12),
                         labels = month.abb[c(1,6,12)]) +
        # annotation
        labs(x = "", 
             y = "%",
             title ="Highest job loss in (semi)-routine occupations",
             subtitle  = "Unemployment rate of UK population, 2020-2021",
             caption = "Source: UK Labour Force Survey (Person)") +
        
        # theme
        theme_economist_white(gray_bg = FALSE) +
        theme(plot.title = element_text(face = "bold",
                                        margin = margin(10, 0, 10, 0),
                                        size = 13),
              # axis.text.x=element_blank(),
              axis.title.x = element_text(margin = margin(t = 5), vjust = 0, size = 10),
              axis.title.y = element_text(margin = margin(r = 3), vjust = 2, size = 10), 
              axis.text = element_text(size = 7),
              legend.position = "top",
              legend.title = element_blank(),
              legend.text = element_text(size=10),
              strip.text = element_text(face = "bold", hjust = 0, size = 9)) +
        guides(color = guide_legend(override.aes = list(size = 3))) 


# alternative?
unem_class %>% 
        # select data
        select(QUARTER, NSECMJ10_2, SEX, Rate) %>%  
        filter(!is.na(Rate & as.integer(NSECMJ10_2)) & as.integer(NSECMJ10_2) != 7)  %>% 
        # graphic type and variables 
        ggplot(aes(x = QUARTER, y = Rate, fill = NSECMJ10_2)) +
        geom_area() +
        facet_wrap(~as_label(SEX)) +
  #scales
        scale_fill_manual(values = c("#FC8DB7", "#791F83", "#006295", "#DF9216","#A3BE41", "#999999")) +
        scale_x_continuous(breaks = seq(1, 12, by = 1),
                         labels = month.abb[1:12]) +
        # annotation
        labs(x = "", 
             y = "%",
             title ="Highest job loss in (semi)-routine occupations",
             subtitle  = "Unemployment rate of UK population, 2020-2021",
             caption = "Source: UK Labour Force Survey (Person)") +
        
        # theme
        theme_economist_white(gray_bg = FALSE) +
        theme(plot.title = element_text(face = "bold",
                                        margin = margin(10, 0, 10, 0),
                                        size = 13),
              # axis.text.x=element_blank(),
              axis.title.x = element_text(margin = margin(t = 5), vjust = 0, size = 10),
              axis.title.y = element_text(margin = margin(r = 3), vjust = 2, size = 10), 
              axis.text = element_text(size = 7),
              legend.position = "top",
              legend.title = element_blank(),
              legend.text = element_text(size=10),
              strip.text = element_text(face = "bold", hjust = 0, size = 9)) +
        guides(color = guide_legend(override.aes = list(size = 3)))

```

```{r income, echo=FALSE}



```

When ethnic background is taken into account, the trend seems less homogeneous-than what?-. While the overall unemployment trend for people in the white ethic group from the first lockdown in March 2020 remained between 6% and 4%, unemployment rates for people in other groups fluctuated well beyond 6% each quarter. For most groups the COVID-19 pandemic increased the unemployment levels seen before the first lockdown. In this respect, men from mixed and black backgrounds have seen a rise in their unemployment compare to women, while women from other minorities have been hit the hardest. Employment seems to be recovering in the last couple of quarters for most groups, but for mixed/multiple and other minorities.

```{r ethnicity, echo=FALSE}

# Unemployment per ethnicity and sex

unem_eth <- LFS_clean %>% 
        filter(AGE >= 18 & AGE <= 64 & IOUTCOME <= 2 & ILODEFR <=2) %>%
        group_by(QUARTER, ETHUKEUL, SEX, as_label(ILODEFR)) %>%
        summarise(Active = sum(PWT18))  %>% 
        pivot_wider(names_from = `as_label(ILODEFR)`, values_from = Active) %>%
        adorn_totals("col") %>%
        mutate(Rate = `Not employed` / Total)

unem_eth %>% 
        # select data
        select(QUARTER, ETHUKEUL, SEX, Rate) %>% 
        filter(!is.na(Rate & ETHUKEUL)) %>% 
       
         # graphic type and variables 
        ggplot(aes(x = QUARTER, y = Rate, col = as_label(SEX))) +
        geom_line(size = 1, show.legend = FALSE) +
        # geom_point(shape = 19) +  
        geom_vline(xintercept = 3, linetype = "dotted") +
        geom_vline(xintercept = 10, linetype = "dotted") +
        facet_wrap(.~as_label(ETHUKEUL), ncol = 3) +
        
        #scales
        scale_colour_manual(values = c("#DF9216", "#791F83")) +
        scale_y_continuous(breaks = seq(0,0.2, 0.02), limits = c(0,0.08), labels = label_percent()) + 
        scale_x_continuous(breaks = c(1, 6, 12),
                         labels = month.abb[c(1,6,12)]) +
        # annotation
        labs(x = "", 
             y = "%",
             title ="Highest job loss in people from non-white backgrounds",
             subtitle  = "Unemployment rate of UK population, 2020-2021",
             caption = "Source: UK Labour Force Survey (Person)") +
        
        # theme
        theme_economist_white(gray_bg = FALSE) +
        theme(plot.title = element_text(face = "bold",
                                        margin = margin(10, 0, 10, 0),
                                        size = 13),
              # axis.text.x=element_blank(),
              axis.title.x = element_text(margin = margin(t = 5), vjust = 0, size = 10),
              axis.title.y = element_text(margin = margin(r = 3), vjust = 2, size = 10), 
              axis.text = element_text(size = 7),
              legend.position = "top",
              legend.title = element_blank(),
              legend.text = element_text(size=10),
              strip.text = element_text(face = "bold", hjust = 0, size = 9)) +
        guides(color = guide_legend(override.aes = list(size = 3))) 

```

```{r age, echo=FALSE}



```

```{r part-time}
# (I dont think there is much interesting here)
pt <- LFS_clean %>% 
        filter(AGE >= 18 & AGE <= 64 & IOUTCOME <= 2 & ILODEFR <= 20) %>% 
        filter(FTPTWK == 2) %>% # select part-timers
        filter(!is.na(YPTJOB)) %>% # select part-timers
        group_by(QUARTER, YPTJOB, SEX, as_label(ILODEFR)) %>%
        summarise(Active = sum(PWT18))  %>% 
        pivot_wider(names_from = `as_label(ILODEFR)`, values_from = Active) %>%
        adorn_totals("col") %>% 
        group_by(QUARTER, SEX) %>%
        mutate(ptreason = `In employment`/sum(`In employment`)*100) %>% 
        as_tibble()


pt %>% 
        # graphic type and variables 
        ggplot(aes(x = QUARTER, y = ptreason, col = as_label(SEX))) +
        geom_line(size = 1, show.legend = FALSE) +
        # geom_point(shape = 19) +  
        geom_vline(xintercept = 3, linetype="dotted") +
        geom_vline(xintercept = 10, linetype="dotted") +
        facet_wrap(.~as_label(YPTJOB), ncol = 2) +
        
        #scales
        scale_colour_manual(values = c("#DF9216", "#791F83")) +
        scale_x_continuous(breaks = c(1, 6, 12),
                         labels = month.abb[c(1,6,12)]) +
        # annotation
        labs(x = "", 
             y = "%",
             caption = "Source: UK Labour Force Survey (Person)") +
        
        # theme
        theme_economist_white(gray_bg = FALSE) +
        theme(plot.title = element_text(face = "bold",
                                        margin = margin(10, 0, 10, 0),
                                        size = 13),
              # axis.text.x=element_blank(),
              axis.title.x = element_text(margin = margin(t = 5), vjust = 0, size = 10),
              axis.title.y = element_text(margin = margin(r = 3), vjust = 2, size = 10), 
              axis.text = element_text(size = 7),
              legend.position = "top",
              legend.title = element_blank(),
              legend.text = element_text(size=10),
              strip.text = element_text(face = "bold", hjust = 0, size = 9)) +
        guides(color = guide_legend(override.aes = list(size = 3))) 


```
```{r time and overtime}
# "EVEROT", # Whether ever work paid or unpaid overtime (filter use only)
#         "POTHR", # Usual hours of paid overtime (filter by EVEROT = 1)
#         "POTHR", # Usual hours of unpaid overtime (filter by EVEROT = 1)
#         "SUMHRS", # Total hours worked in reference week in main and second jobs
# 
LFS_clean %>% 
  filter(!ILODEFR ==2) %>% 
  mutate(SEX = as.factor(SEX),
         SUMHRS = as.numeric(SUMHRS)) %>% 
  select(QUARTER, SEX, SUMHRS) %>%
  group_by(QUARTER, SEX) %>% 
  summarise(mean.hours = mean(SUMHRS, na.rm = TRUE),
            sd.hours = sd(SUMHRS, na.rm = TRUE)) %>% 
  ggplot(aes(x = QUARTER, y = mean.hours,  fill = SEX)) +
  geom_line(size = 1, show.legend = FALSE) +
        # geom_point(shape = 19) + 
        # geom_vline(xintercept = 3, linetype="dotted") +
        #scales
        scale_colour_manual(values = c("#DF9216", "#791F83")) +
        scale_y_continuous(breaks = seq(0,0.06, 0.01), limits = c(0, 0.07), labels = label_percent()) +
        scale_x_continuous(breaks = seq(1, 12, by = 1),
                         labels = month.abb[1:12]) +
        # annotation
        labs(x = "", 
             y = "%",
             title ="Men's employment hit the most by the COVID-19 pandemic",
             subtitle  = "Unemployment rate of UK population between, 2020-2021",
             caption = c("Source: UK Labour Force Survey (Person)")) +
        annotate(geom = "text", x = 12, y = 0.053, label = "Men", color= "#DF9216") +
        annotate(geom = "text", x = 12, y = 0.040, label = "Women", color= "#791F83") +
        annotate(geom = "rect", xmin = 3,  xmax = 6, ymin = 0,  ymax = 0.07, alpha = 0.2) +
        annotate(geom = "rect", xmin = 10, xmax = 11, ymin = 0, ymax = 0.07, alpha = 0.2) +
        # theme
        theme_economist_white(gray_bg = FALSE) +
        theme(plot.title = element_text(face = "bold",
                                        margin = margin(10, 0, 10, 0),
                                        size = 13),
              axis.title.x = element_text(margin = margin(t = 5), vjust = 0, size = 10),
              axis.title.y = element_text(margin = margin(r = 3), vjust = 2, size = 10), 
              axis.text = element_text(size = 11),
              legend.position = "none",
              legend.title = element_blank()) 
  
```

